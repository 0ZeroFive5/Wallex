"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _electron = require("electron");

var _electronWallpaper = _interopRequireDefault(require("../electronWallpaper"));

var _path = _interopRequireDefault(require("path"));

_electron.app.allowRendererProcessReuse = true;
var wallpaperWindows = [];
var tray;
var currentScreen;
var currentScreenIdx;
var screens;

var getOffsetX = function getOffsetX() {
  if (!currentScreen || currentScreenIdx === null || !screens) {
    throw Error("Current screen is unset!");
  }

  if (currentScreenIdx === 0) {
    return 0;
  } else {
    var screensToTheLeft = screens.slice(0, currentScreenIdx);
    return screensToTheLeft.reduce(function (sum, item) {
      return sum + item.bounds.width;
    }, 0); // My trial and error approach to windows positioning system
  }
};

var destroyWallpaper = function destroyWallpaper(idx) {
  if (wallpaperWindows[idx]) {
    wallpaperWindows[idx].close();
    wallpaperWindows = wallpaperWindows.filter(function (_, index) {
      return index !== idx;
    });
  }
};

var createWallpaperWindow = function createWallpaperWindow() {
  if (!currentScreen || currentScreenIdx === null || !screens) {
    throw Error("Current screen is unset!");
  }

  wallpaperWindows[currentScreenIdx] = new _electron.BrowserWindow({
    width: 1000,
    // Initial value cuz electron || windows (I don't know what's the problem at this point)
    height: 1000,
    // Initial value cuz electron || windows (I don't know what's the problem at this point)
    autoHideMenuBar: true,
    frame: false,
    transparent: true // webPreferences: {
    //   nodeIntegration: true,
    //   contextIsolation: false,
    //   enableRemoteModule: true
    // }, // 3 fucking lines cuz electron is "SECURE" now
    // The lines above allow node modules in wallpapers

  });
  wallpaperWindows[currentScreenIdx].loadFile('../public/dashboard.html');

  _electronWallpaper["default"].attachWindow(wallpaperWindows[currentScreenIdx], getOffsetX(), currentScreen.bounds.y, currentScreen.bounds.width, currentScreen.bounds.height);
};

var setCurrentScreen = function setCurrentScreen(idx) {
  if (!screens) {
    throw Error("Screens hasn't been initialized!");
  }

  currentScreen = screens[idx];
  currentScreenIdx = idx;
  destroyWallpaper(idx);
  createWallpaperWindow();
};

var createTray = function createTray() {
  if (!screens) {
    throw Error("Screens hasn't been initialized!");
  }

  tray = new _electron.Tray(_path["default"].join(__dirname, '../public/logo.png'));

  var ctxMenu = _electron.Menu.buildFromTemplate([].concat((0, _toConsumableArray2["default"])(screens.map(function (_, idx) {
    return {
      label: "Screen ".concat(idx + 1),
      type: 'submenu',
      submenu: [{
        label: 'Disable',
        type: 'normal',
        click: function click() {
          return destroyWallpaper(idx);
        }
      }, {
        label: 'Default',
        type: 'normal',
        click: function click() {
          return setCurrentScreen(idx);
        }
      }]
    };
  })), [{
    label: 'quit',
    type: 'normal',
    click: function click() {
      wallpaperWindows.map(function (_, idx) {
        return destroyWallpaper(idx);
      });

      _electron.app.quit();
    }
  }]));

  tray.setToolTip('Wallex');
  tray.setContextMenu(ctxMenu);
};

_electron.app.on('ready', function () {
  screens = _electron.screen.getAllDisplays().sort(function (a, b) {
    return a.bounds.x - b.bounds.x;
  }); // Electron can't into multi display setups

  createTray();
});

_electron.app.on('window-all-closed', function () {}); // Overwrites the default exit behaviour
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJhcHAiLCJhbGxvd1JlbmRlcmVyUHJvY2Vzc1JldXNlIiwid2FsbHBhcGVyV2luZG93cyIsInRyYXkiLCJjdXJyZW50U2NyZWVuIiwiY3VycmVudFNjcmVlbklkeCIsInNjcmVlbnMiLCJnZXRPZmZzZXRYIiwiRXJyb3IiLCJzY3JlZW5zVG9UaGVMZWZ0Iiwic2xpY2UiLCJyZWR1Y2UiLCJzdW0iLCJpdGVtIiwiYm91bmRzIiwid2lkdGgiLCJkZXN0cm95V2FsbHBhcGVyIiwiaWR4IiwiY2xvc2UiLCJmaWx0ZXIiLCJfIiwiaW5kZXgiLCJjcmVhdGVXYWxscGFwZXJXaW5kb3ciLCJCcm93c2VyV2luZG93IiwiaGVpZ2h0IiwiYXV0b0hpZGVNZW51QmFyIiwiZnJhbWUiLCJ0cmFuc3BhcmVudCIsImxvYWRGaWxlIiwiZWxlY3Ryb25XYWxscGFwZXIiLCJhdHRhY2hXaW5kb3ciLCJ5Iiwic2V0Q3VycmVudFNjcmVlbiIsImNyZWF0ZVRyYXkiLCJUcmF5IiwicGF0aCIsImpvaW4iLCJfX2Rpcm5hbWUiLCJjdHhNZW51IiwiTWVudSIsImJ1aWxkRnJvbVRlbXBsYXRlIiwibWFwIiwibGFiZWwiLCJ0eXBlIiwic3VibWVudSIsImNsaWNrIiwicXVpdCIsInNldFRvb2xUaXAiLCJzZXRDb250ZXh0TWVudSIsIm9uIiwic2NyZWVuIiwiZ2V0QWxsRGlzcGxheXMiLCJzb3J0IiwiYSIsImIiLCJ4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFHQUEsY0FBSUMseUJBQUosR0FBZ0MsSUFBaEM7QUFFQSxJQUFJQyxnQkFBaUMsR0FBRyxFQUF4QztBQUNBLElBQUlDLElBQUo7QUFDQSxJQUFJQyxhQUFKO0FBQ0EsSUFBSUMsZ0JBQUo7QUFFQSxJQUFJQyxPQUFKOztBQUVBLElBQU1DLFVBQVUsR0FBRyxTQUFiQSxVQUFhLEdBQU07QUFDdkIsTUFBSSxDQUFDSCxhQUFELElBQWtCQyxnQkFBZ0Is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QyxpQkFBT0MsY0FBUCxHQUF3QkMsSUFBeEIsQ0FBNkIsVUFBQ0MsQ0FBRCxFQUFJQyxDQUFKO0FBQUEsV0FBVUQsQ0FBQyxDQUFDdkMsTUFBRixDQUFTeUMsQ0FBVCxHQUFhRCxDQUFDLENBQUN4QyxNQUFGLENBQVN5QyxDQUFoQztBQUFBLEdBQTdCLENBQVYsQ0FEb0IsQ0FDdUQ7O0FBQzNFdEIsRUFBQUEsVUFBVTtBQUNYLENBSEQ7O0FBS0FqQyxjQUFJaUQsRUFBSixDQUFPLG1CQUFQLEVBQTRCLFlBQU0sQ0FBRSxDQUFwQyxFLENBQXVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHthcHAsIE1lbnUsIFRyYXksIEJyb3dzZXJXaW5kb3csIHNjcmVlbiwgTWVudUl0ZW1Db25zdHJ1Y3Rvck9wdGlvbnN9IGZyb20gJ2VsZWN0cm9uJztcclxuaW1wb3J0IGVsZWN0cm9uV2FsbHBhcGVyIGZyb20gJy4uL2VsZWN0cm9uV2FsbHBhcGVyJztcclxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XHJcblxyXG5cclxuYXBwLmFsbG93UmVuZGVyZXJQcm9jZXNzUmV1c2UgPSB0cnVlO1xyXG5cclxubGV0IHdhbGxwYXBlcldpbmRvd3M6IEJyb3dzZXJXaW5kb3dbXSA9IFtdO1xyXG5sZXQgdHJheTogVHJheSB8IG51bGw7XHJcbmxldCBjdXJyZW50U2NyZWVuOiBFbGVjdHJvbi5EaXNwbGF5IHwgbnVsbDtcclxubGV0IGN1cnJlbnRTY3JlZW5JZHg6IG51bWJlciB8IG51bGw7XHJcblxyXG5sZXQgc2NyZWVuczogRWxlY3Ryb24uRGlzcGxheVtdIHwgbnVsbDtcclxuXHJcbmNvbnN0IGdldE9mZnNldFggPSAoKSA9PiB7XHJcbiAgaWYgKCFjdXJyZW50U2NyZWVuIHx8IGN1cnJlbnRTY3JlZW5JZHggPT09IG51bGwgfHwgIXNjcmVlbnMpIHtcclxuICAgIHRocm93IEVycm9yKFwiQ3VycmVudCBzY3JlZW4gaXMgdW5zZXQhXCIpO1xyXG4gIH1cclxuICBpZiAoY3VycmVudFNjcmVlbklkeCA9PT0gMCkge1xyXG4gICAgcmV0dXJuIDA7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnN0IHNjcmVlbnNUb1RoZUxlZnQgPSBzY3JlZW5zLnNsaWNlKDAsIGN1cnJlbnRTY3JlZW5JZHgpO1xyXG4gICAgcmV0dXJuIHNjcmVlbnNUb1RoZUxlZnQucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIGl0ZW0uYm91bmRzLndpZHRoLCAwKTsgLy8gTXkgdHJpYWwgYW5kIGVycm9yIGFwcHJvYWNoIHRvIHdpbmRvd3MgcG9zaXRpb25pbmcgc3lzdGVtXHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBkZXN0cm95V2FsbHBhcGVyID0gKGlkeDogbnVtYmVyKSA9PiB7XHJcbiAgaWYgKHdhbGxwYXBlcldpbmRvd3NbaWR4XSkge1xyXG4gICAgd2FsbHBhcGVyV2luZG93c1tpZHhdLmNsb3NlKCk7XHJcbiAgICB3YWxscGFwZXJXaW5kb3dzID0gd2FsbHBhcGVyV2luZG93cy5maWx0ZXIoKF8sIGluZGV4KSA9PiBpbmRleCAhPT0gaWR4KTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGNyZWF0ZVdhbGxwYXBlcldpbmRvdyA9IGZ1bmN0aW9uKCkge1xyXG4gIGlmICghY3VycmVudFNjcmVlbiB8fCBjdXJyZW50U2NyZWVuSWR4ID09PSBudWxsIHx8ICFzY3JlZW5zKSB7XHJcbiAgICB0aHJvdyBFcnJvcihcIkN1cnJlbnQgc2NyZWVuIGlzIHVuc2V0IVwiKTtcclxuICB9XHJcbiAgd2FsbHBhcGVyV2luZG93c1tjdXJyZW50U2NyZWVuSWR4XSA9IG5ldyBCcm93c2VyV2luZG93KHtcclxuICAgIHdpZHRoOiAxMDAwLCAvLyBJbml0aWFsIHZhbHVlIGN1eiBlbGVjdHJvbiB8fCB3aW5kb3dzIChJIGRvbid0IGtub3cgd2hhdCdzIHRoZSBwcm9ibGVtIGF0IHRoaXMgcG9pbnQpXHJcbiAgICBoZWlnaHQ6IDEwMDAsIC8vIEluaXRpYWwgdmFsdWUgY3V6IGVsZWN0cm9uIHx8IHdpbmRvd3MgKEkgZG9uJ3Qga25vdyB3aGF0J3MgdGhlIHByb2JsZW0gYXQgdGhpcyBwb2ludClcclxuICAgIGF1dG9IaWRlTWVudUJhcjogdHJ1ZSxcclxuICAgIGZyYW1lOiBmYWxzZSxcclxuICAgIHRyYW5zcGFyZW50OiB0cnVlLFxyXG4gICAgLy8gd2ViUHJlZmVyZW5jZXM6IHtcclxuICAgIC8vICAgbm9kZUludGVncmF0aW9uOiB0cnVlLFxyXG4gICAgLy8gICBjb250ZXh0SXNvbGF0aW9uOiBmYWxzZSxcclxuICAgIC8vICAgZW5hYmxlUmVtb3RlTW9kdWxlOiB0cnVlXHJcbiAgICAvLyB9LCAvLyAzIGZ1Y2tpbmcgbGluZXMgY3V6IGVsZWN0cm9uIGlzIFwiU0VDVVJFXCIgbm93XHJcbiAgICAvLyBUaGUgbGluZXMgYWJvdmUgYWxsb3cgbm9kZSBtb2R1bGVzIGluIHdhbGxwYXBlcnNcclxuICB9KTtcclxuICB3YWxscGFwZXJXaW5kb3dzW2N1cnJlbnRTY3JlZW5JZHhdLmxvYWRGaWxlKCcuLi9wdWJsaWMvZGFzaGJvYXJkLmh0bWwnKTtcclxuICBlbGVjdHJvbldhbGxwYXBlci5hdHRhY2hXaW5kb3cod2FsbHBhcGVyV2luZG93c1tjdXJyZW50U2NyZWVuSWR4XSwgZ2V0T2Zmc2V0WCgpLFxyXG4gICAgY3VycmVudFNjcmVlbi5ib3VuZHMueSwgY3VycmVudFNjcmVlbi5ib3VuZHMud2lkdGgsIGN1cnJlbnRTY3JlZW4uYm91bmRzLmhlaWdodCk7XHJcbn07XHJcblxyXG5jb25zdCBzZXRDdXJyZW50U2NyZWVuID0gKGlkeDogbnVtYmVyKSA9PiB7XHJcbiAgaWYgKCFzY3JlZW5zKSB7XHJcbiAgICB0aHJvdyBFcnJvcihcIlNjcmVlbnMgaGFzbid0IGJlZW4gaW5pdGlhbGl6ZWQhXCIpO1xyXG4gIH1cclxuICBjdXJyZW50U2NyZWVuID0gc2NyZWVuc1tpZHhdO1xyXG4gIGN1cnJlbnRTY3JlZW5JZHggPSBpZHg7XHJcbiAgZGVzdHJveVdhbGxwYXBlcihpZHgpO1xyXG4gIGNyZWF0ZVdhbGxwYXBlcldpbmRvdygpO1xyXG59XHJcblxyXG5jb25zdCBjcmVhdGVUcmF5ID0gKCkgPT4ge1xyXG4gIGlmICghc2NyZWVucykge1xyXG4gICAgdGhyb3cgRXJyb3IoXCJTY3JlZW5zIGhhc24ndCBiZWVuIGluaXRpYWxpemVkIVwiKTtcclxuICB9XHJcbiAgdHJheSA9IG5ldyBUcmF5KHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9wdWJsaWMvbG9nby5wbmcnKSk7XHJcbiAgY29uc3QgY3R4TWVudSA9IE1lbnUuYnVpbGRGcm9tVGVtcGxhdGUoW1xyXG4gICAgLy8geyBsYWJlbDogJ2Rpc3BsYXknLCB0eXBlOiAnc3VibWVudScsIHN1Ym1lbnU6IFtcclxuICAgIC8vICAgLi4uKHNjcmVlbnMubWFwKChfLCBpZHgpOiBNZW51SXRlbUNvbnN0cnVjdG9yT3B0aW9ucyA9PiAoe1xyXG4gICAgLy8gICAgIGxhYmVsOiBpZHgudG9TdHJpbmcoKSxcclxuICAgIC8vICAgICB0eXBlOiAnbm9ybWFsJyxcclxuICAgIC8vICAgICBjbGljazogKCkgPT4gc2V0Q3VycmVudFNjcmVlbihpZHgpXHJcbiAgICAvLyAgIH0pKSlcclxuICAgIC8vIF0gfSwgLy8gVGhpcyBjcmVhdGVzIGEgbWVudSBlbnRyeSBmb3IgZXZlcnkgbW9uaXRvciBhdmFpbGFibGUgaW4gdGhlIHN5c3RlbS4gVE9ETzogYWxsb3cgbXVsdGlwbHkgbW9uaXRvcnNcclxuICAgIC4uLihzY3JlZW5zLm1hcCgoXywgaWR4KTogTWVudUl0ZW1Db25zdHJ1Y3Rvck9wdGlvbnMgPT4ge1xyXG4gICAgICByZXR1cm4geyBsYWJlbDogYFNjcmVlbiAke2lkeCsxfWAsIHR5cGU6ICdzdWJtZW51Jywgc3VibWVudTogW1xyXG4gICAgICAgIHsgbGFiZWw6ICdEaXNhYmxlJywgdHlwZTogJ25vcm1hbCcsIGNsaWNrOiAoKSA9PiBkZXN0cm95V2FsbHBhcGVyKGlkeCkgfSxcclxuICAgICAgICB7IGxhYmVsOiAnRGVmYXVsdCcsIHR5cGU6ICdub3JtYWwnLCBjbGljazogKCkgPT4gc2V0Q3VycmVudFNjcmVlbihpZHgpIH1cclxuICAgICAgXSB9XHJcbiAgICB9KSksXHJcbiAgICB7IGxhYmVsOiAncXVpdCcsIHR5cGU6ICdub3JtYWwnLCBjbGljazogKCkgPT4geyBcclxuICAgICAgd2FsbHBhcGVyV2luZG93cy5tYXAoKF8sIGlkeCkgPT4gZGVzdHJveVdhbGxwYXBlcihpZHgpKTtcclxuICAgICAgYXBwLnF1aXQoKTtcclxuICAgIH0gfVxyXG4gIF0pO1xyXG4gIHRyYXkuc2V0VG9vbFRpcCgnV2FsbGV4Jyk7XHJcbiAgdHJheS5zZXRDb250ZXh0TWVudShjdHhNZW51KTtcclxufVxyXG5cclxuXHJcbmFwcC5vbigncmVhZHknLCAoKSA9PiB7XHJcbiAgc2NyZWVucyA9IHNjcmVlbi5nZXRBbGxEaXNwbGF5cygpLnNvcnQoKGEsIGIpID0+IGEuYm91bmRzLnggLSBiLmJvdW5kcy54KTsgLy8gRWxlY3Ryb24gY2FuJ3QgaW50byBtdWx0aSBkaXNwbGF5IHNldHVwc1xyXG4gIGNyZWF0ZVRyYXkoKTtcclxufSk7XHJcblxyXG5hcHAub24oJ3dpbmRvdy1hbGwtY2xvc2VkJywgKCkgPT4ge30pOyAvLyBPdmVyd3JpdGVzIHRoZSBkZWZhdWx0IGV4aXQgYmVoYXZpb3VyIl19